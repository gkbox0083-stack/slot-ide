# Reel 修正完成 - 測試指引

## ✅ 修正確認

所有修正已成功套用到 `src/runtime/Reel.tsx`，並通過 TypeScript 編譯檢查。

### 修正內容摘要

1. **符號錯位修正**：
   - stopped 狀態 transform 從 `translateY(-symbolHeight * 1)` 改為 `translateY(0)`
   - stopped 狀態 offset 從 `symbolHeight * 1` 改為 `0`

2. **輪帶消失修正**：
   - 分別計算 `dummyBaseTranslate` 和 `finalBaseTranslate`
   - 根據 `showFinalSymbols` 動態選擇對應的 `baseTranslate`

3. **高亮邏輯修正**：
   - 使用動態 `currentIconsCount` 計算 `middleStart`
   - 確保高亮邏輯正確對齊到可見區域

## 🧪 測試步驟

### 1. 啟動開發伺服器

```bash
npm run dev
```

### 2. 開啟瀏覽器

訪問 Vite 顯示的網址（通常是 `http://localhost:5173`）

### 3. 測試流程

#### 步驟 1：等待盤池建立（自動執行）
- ✅ 觀察狀態顯示「✅ 盤池建立完成！共 X 個盤面」
- ✅ 檢查 Console 的「Build Pools 結果」

#### 步驟 2：點擊 Spin 按鈕
- ✅ 觀察狀態變為「🎰 動畫進行中...」
- ✅ 檢查 Console 的「SpinPacket 產生」

#### 步驟 3：觀察動畫
- ✅ **驗證輪帶方向**：輪帶應該**向下旋轉**（符號從上方進入視野）
- ✅ **驗證動畫流暢**：5 輪開始滾動，依序停輪（從左到右，間隔正確）
- ✅ **驗證無消失**：stopping 階段符號列表不消失
- ✅ 停輪後顯示正確的符號

#### 步驟 4：動畫完成
- ✅ 狀態變為「✅ 動畫完成！」
- ✅ 如果有中獎線，顯示金色連線
- ✅ 中獎符號有高亮效果
- ✅ 中獎線每秒循環切換（如果有多條）

#### 步驟 5：驗證盤面
- ✅ 展開「查看完整 Board」
- ✅ **關鍵驗證**：比對 SlotMachine 顯示的符號與 SpinPacket.board 是否一致
  - 例如：`board.reels[0] = ["L3", "H2", "L1"]`
  - 顯示順序應該是：row 0 = L3, row 1 = H2, row 2 = L1
- ✅ 檢查 Console 的「驗證盤面」資訊

## 📋 驗證清單

### A. Build Pools 驗證
- [ ] Console 顯示「Build Pools 結果」
- [ ] 狀態顯示「✅ 盤池建立完成！共 X 個盤面」
- [ ] `result.success` 為 `true`
- [ ] `result.pools` 有內容

### B. Spin 驗證
- [ ] Console 顯示完整的 SpinPacket
- [ ] 狀態顯示「🎰 動畫進行中...」
- [ ] 5 輪開始滾動

### C. 動畫驗證（關鍵）
- [ ] **輪帶向下旋轉**（符號從上方進入視野）✅
- [ ] 5 輪依序停輪（間隔正確）
- [ ] **stopping 階段符號列表不消失**✅
- [ ] 停輪後顯示正確的符號
- [ ] 如果有中獎線，顯示金色連線
- [ ] 中獎符號有高亮效果
- [ ] 中獎線每秒循環切換（如果有多條）

### D. 盤面一致性驗證（關鍵）
- [ ] Console 顯示「驗證盤面」
- [ ] 展開「查看完整 Board」比對符號
- [ ] **SlotMachine 顯示的符號與 `SpinPacket.board` 完全一致**✅
  - 例如：`board.reels[0] = ["L3", "H2", "L1"]`
  - 顯示順序：row 0 = L3, row 1 = H2, row 2 = L1
- [ ] 中獎線高亮正確（如果有）

## 🔍 Console 輸出說明

測試過程中，Console 會輸出以下資訊：

### 1. Build Pools 結果
```
=== Build Pools 結果 ===
成功: true
Pool 狀態: [...]
錯誤: []
```

### 2. SpinPacket 產生
```
=== SpinPacket 產生 ===
Board: {...}
Meta: {...}
完整 SpinPacket: {...}
```

### 3. 驗證盤面
```
=== 驗證盤面 ===
SpinPacket.board: {...}
中獎線數量: X
中獎線資訊: [...]
```

## 🎯 進階測試

可以進行以下進階測試：

1. **多次 Spin**：連續點擊 Spin 按鈕，觀察每次結果
2. **跳過動畫**：在動畫進行中點擊「跳過動畫」按鈕
3. **中獎線循環**：如果有中獎線，觀察每秒切換
4. **不同 Outcome**：多次 Spin 觀察不同的 Outcome 和倍率

## ⚠️ 疑難排解

如果遇到問題：

1. **符號錯位**：
   - 檢查 Console 的 Board 與實際顯示是否一致
   - 確認 stopped 狀態時 offset = 0

2. **輪帶消失**：
   - 檢查 Console 是否有錯誤訊息
   - 確認 `showFinalSymbols` 在正確時機切換

3. **輪帶向上旋轉**：
   - 確認 offset 計算方向正確
   - 檢查 `baseTranslate` 是否使用正確的值

4. **其他問題**：
   - 檢查 Console 錯誤訊息
   - 確認盤池是否已建立（狀態顯示）
   - 檢查 SpinPacket 結構是否完整（展開「查看完整 SpinPacket」）
   - 確認 SlotMachine 是否正確接收 spinPacket（觀察動畫是否觸發）

## 📝 修正檔案清單

- ✅ `src/runtime/Reel.tsx` - 已修正
- ✅ `src/App.tsx` - 已更新為完整測試介面
- ✅ TypeScript 編譯檢查：通過
- ✅ Linter 檢查：無錯誤

---

**測試準備完成！執行 `npm run dev` 開始測試。**

